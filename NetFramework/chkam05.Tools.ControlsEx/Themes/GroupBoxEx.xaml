<ResourceDictionary
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:conv="clr-namespace:chkam05.Tools.ControlsEx.Converters"
    xmlns:local="clr-namespace:chkam05.Tools.ControlsEx"
    xmlns:theme="clr-namespace:chkam05.Tools.ControlsEx.Data.Theme"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml">

    <conv:GroupBoxExHeaderMarginConverter x:Key="GroupBoxExHeaderMarginConverter"/>
    <x:Static x:Key="ThemeMgr" Member="theme:ThemeManager.Instance"/>

    <ControlTemplate x:Key="GroupBoxEx.ControlTemplate" TargetType="{x:Type local:GroupBoxEx}">
        <Grid
            SnapsToDevicePixels="true">

            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>

            <Border
                Background="{TemplateBinding Background}"
                BorderBrush="{TemplateBinding BorderBrush}"
                BorderThickness="1"
                CornerRadius="{TemplateBinding CornerRadius}"
                Grid.Row="1">

                <ContentPresenter
                    Margin="{TemplateBinding Padding}"
                    SnapsToDevicePixels="{TemplateBinding SnapsToDevicePixels}"/>

            </Border>

            <Grid
                Grid.Row="0"
                Margin="{Binding ActualHeight, ElementName=headerBorder, Converter={StaticResource GroupBoxExHeaderMarginConverter}}">

                <Border
                    x:Name="headerBorder"
                    Background="{TemplateBinding Background}"
                    BorderBrush="{x:Null}"
                    BorderThickness="0"
                    CornerRadius="{TemplateBinding CornerRadius}"
                    HorizontalAlignment="Left"
                    Margin="{TemplateBinding HeaderMargin}"
                    Padding="{TemplateBinding HeaderPadding}"
                    VerticalAlignment="Center">

                    <ContentPresenter
                        ContentSource="Header"
                        RecognizesAccessKey="True"
                        SnapsToDevicePixels="{TemplateBinding SnapsToDevicePixels}"/>

                </Border>
            </Grid>
        </Grid>
    </ControlTemplate>

    <Style x:Key="GroupBoxExStyle" TargetType="{x:Type local:GroupBoxEx}">
        <Setter Property="Background" Value="{Binding DataContext.ThemeBackground, Mode=OneWay, Source={StaticResource ThemeMgr}}"/>
        <Setter Property="BackgroundInactive" Value="{Binding DataContext.BackgroundInactive, Mode=OneWay, Source={StaticResource ThemeMgr}}"/>
        <Setter Property="BorderBrush" Value="{Binding DataContext.AccentBorderBrush, Mode=OneWay, Source={StaticResource ThemeMgr}}"/>
        <Setter Property="BorderBrushInactive" Value="{Binding DataContext.BorderBrushInactive, Mode=OneWay, Source={StaticResource ThemeMgr}}"/>
        <Setter Property="BorderThickness" Value="1"/>
        <Setter Property="HeaderForeground" Value="{Binding DataContext.ThemeForeground, Mode=OneWay, Source={StaticResource ThemeMgr}}"/>
        <Setter Property="Padding" Value="4"/>
        <Setter Property="Template" Value="{StaticResource GroupBoxEx.ControlTemplate}"/>
    </Style>

</ResourceDictionary>